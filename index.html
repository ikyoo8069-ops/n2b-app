<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N2B 정부지원사업 매칭 v3.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-6 shadow-lg">
        <div class="container mx-auto px-4">
            <h1 class="text-3xl font-bold">🚀 N2B 정부지원사업 매칭</h1>
            <p class="text-purple-100 mt-1">v3.1 - 지역 필터링 지원 | 97,794개 정책 DB</p>
        </div>
    </header>

    <main class="container mx-auto px-4 py-8">
        <!-- API Key Input -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                🔑 Anthropic API Key
            </label>
            <input type="password" id="apiKey" 
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                   placeholder="sk-ant-api...">
        </div>

        <!-- Region Filter -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                📍 지역 선택
            </label>
            <select id="regionSelect" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent bg-white">
                <option value="전체">🇰🇷 전체 (전국)</option>
                <option value="서울">서울특별시</option>
                <option value="부산">부산광역시</option>
                <option value="대구">대구광역시</option>
                <option value="인천">인천광역시</option>
                <option value="광주">광주광역시</option>
                <option value="대전">대전광역시</option>
                <option value="울산">울산광역시</option>
                <option value="세종">세종특별자치시</option>
                <option value="경기">경기도</option>
                <option value="강원">강원특별자치도</option>
                <option value="충북">충청북도</option>
                <option value="충남">충청남도</option>
                <option value="전북">전북특별자치도</option>
                <option value="전남">전라남도</option>
                <option value="경북">경상북도</option>
                <option value="경남">경상남도</option>
                <option value="제주">제주특별자치도</option>
            </select>
            <p class="text-xs text-gray-500 mt-2">💡 지역을 선택하면 해당 지역의 지원사업만 검색됩니다.</p>
        </div>

        <!-- Proposal Input -->
        <div class="bg-white rounded-xl shadow-md p-6 mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">
                📝 사업계획서 요약
            </label>
            <textarea id="proposalText" rows="6"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                      placeholder="사업 아이디어를 입력하세요..."></textarea>
            
            <!-- Sample Buttons with Region -->
            <div class="mt-4">
                <p class="text-sm text-gray-600 mb-2">📋 샘플 (지역 포함):</p>
                <div class="flex flex-wrap gap-2">
                    <button onclick="loadSample('ai_seoul')" 
                            class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm hover:bg-purple-200">
                        AI 스타트업 (서울)
                    </button>
                    <button onclick="loadSample('green_gyeonggi')" 
                            class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm hover:bg-green-200">
                        친환경 제조 (경기)
                    </button>
                    <button onclick="loadSample('tourism_busan')" 
                            class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm hover:bg-blue-200">
                        관광 플랫폼 (부산)
                    </button>
                    <button onclick="loadSample('farm_jeonnam')" 
                            class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-sm hover:bg-yellow-200">
                        스마트팜 (전남)
                    </button>
                    <button onclick="loadSample('marine_jeju')" 
                            class="px-3 py-1 bg-cyan-100 text-cyan-700 rounded-full text-sm hover:bg-cyan-200">
                        해양바이오 (제주)
                    </button>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4 mb-8">
            <button onclick="analyzeN2B()" 
                    class="flex-1 gradient-bg text-white py-4 rounded-xl font-bold hover:opacity-90 transition shadow-lg">
                1️⃣ N2B 분석
            </button>
            <button onclick="matchPrograms()" id="matchBtn" disabled
                    class="flex-1 bg-gray-400 text-white py-4 rounded-xl font-bold transition shadow-lg disabled:opacity-50">
                2️⃣ 지원사업 매칭
            </button>
        </div>

        <!-- Loading Indicator -->
        <div id="loading" class="hidden text-center py-8">
            <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-purple-500 border-t-transparent"></div>
            <p class="mt-4 text-gray-600">분석 중...</p>
        </div>

        <!-- N2B Analysis Result -->
        <div id="n2bResult" class="hidden bg-white rounded-xl shadow-md p-6 mb-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">📊 N2B 분석 결과</h2>
            <div class="space-y-4">
                <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
                    <h3 class="font-bold text-red-700">N (Not) - 문제점</h3>
                    <p id="resultN" class="text-gray-700 mt-1"></p>
                </div>
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                    <h3 class="font-bold text-blue-700">B (But) - 솔루션</h3>
                    <p id="resultB" class="text-gray-700 mt-1"></p>
                </div>
                <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded">
                    <h3 class="font-bold text-green-700">C (Because) - 근거</h3>
                    <p id="resultC" class="text-gray-700 mt-1"></p>
                </div>
                <div class="bg-purple-50 p-4 rounded">
                    <h3 class="font-bold text-purple-700">🏷️ 키워드</h3>
                    <div id="resultKeywords" class="flex flex-wrap gap-2 mt-2"></div>
                </div>
            </div>
        </div>

        <!-- Matching Results -->
        <div id="matchResult" class="hidden">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold text-gray-800">🎯 매칭된 지원사업</h2>
                <span id="regionBadge" class="px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm"></span>
            </div>
            <div id="programList" class="space-y-4"></div>
        </div>
    </main>

    <script>
        let n2bAnalysis = null;
        // ⚠️ 아래 URL을 실제 Railway 백엔드 주소로 변경하세요!
        const API_BASE = 'https://n2b-backend-production.up.railway.app';

        const samples = {
            ai_seoul: {
                region: '서울',
                text: `서울 소재 AI 스타트업으로, 중소기업의 디지털 전환을 위한 AI 기반 업무 자동화 솔루션을 개발합니다. 
기존 수작업 프로세스의 50% 이상 자동화를 목표로 하며, 클라우드 기반으로 초기 도입 비용을 최소화합니다.
서울디지털재단 및 서울산업진흥원 협력을 통해 서울 지역 중소기업 1,000개사 도입을 목표로 합니다.`
            },
            green_gyeonggi: {
                region: '경기',
                text: `경기도 화성 소재 제조기업으로, 탄소중립 실현을 위한 친환경 포장재 생산 시스템을 구축합니다.
기존 플라스틱 포장재를 100% 생분해성 소재로 대체하여 환경 오염을 저감하고,
경기도 그린뉴딜 정책과 연계하여 도내 식품기업에 친환경 포장 솔루션을 공급합니다.`
            },
            tourism_busan: {
                region: '부산',
                text: `부산 해운대구 기반의 관광 스타트업으로, AI 기반 맞춤형 부산 관광 플랫폼을 개발합니다.
외국인 관광객을 위한 다국어 AI 가이드 서비스와 지역 소상공인 연계 예약 시스템을 통합하여,
부산시 관광산업 활성화에 기여합니다. 2025년 APEC 정상회의 연계 서비스 출시 목표.`
            },
            farm_jeonnam: {
                region: '전남',
                text: `전라남도 나주 소재 농업회사법인으로, IoT 기반 스마트팜 통합관리 시스템을 구축합니다.
기존 노지 재배의 불확실성을 센서 데이터 기반 정밀농업으로 전환하여 생산성 30% 향상을 목표로 합니다.
전남 농업기술원과 협력하여 도내 농가 500곳 보급을 추진합니다.`
            },
            marine_jeju: {
                region: '제주',
                text: `제주특별자치도 기반의 해양바이오 벤처로, 해조류에서 고부가가치 기능성 소재를 추출합니다.
기존 해조류 가공의 저수익 구조를 바이오 기술로 혁신하여 화장품/의약품 원료 시장에 진출합니다.
제주테크노파크와 협력하여 제주 해양자원의 부가가치를 극대화합니다.`
            }
        };

        function loadSample(key) {
            const sample = samples[key];
            document.getElementById('proposalText').value = sample.text;
            document.getElementById('regionSelect').value = sample.region;
        }

        async function analyzeN2B() {
            const apiKey = document.getElementById('apiKey').value;
            const proposalText = document.getElementById('proposalText').value;

            if (!apiKey || !proposalText) {
                alert('API Key와 사업계획서를 입력해주세요.');
                return;
            }

            showLoading(true);

            try {
                const response = await fetch(`${API_BASE}/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ apiKey, proposalText })
                });

                if (!response.ok) throw new Error('분석 실패');

                n2bAnalysis = await response.json();

                document.getElementById('resultN').textContent = n2bAnalysis.N;
                document.getElementById('resultB').textContent = n2bAnalysis.B;
                document.getElementById('resultC').textContent = n2bAnalysis.C;

                const keywordsDiv = document.getElementById('resultKeywords');
                keywordsDiv.innerHTML = n2bAnalysis.keywords.map(k => 
                    `<span class="px-3 py-1 bg-purple-200 text-purple-800 rounded-full text-sm">${k}</span>`
                ).join('');

                document.getElementById('n2bResult').classList.remove('hidden');
                document.getElementById('matchBtn').disabled = false;
                document.getElementById('matchBtn').classList.remove('bg-gray-400');
                document.getElementById('matchBtn').classList.add('bg-green-500', 'hover:bg-green-600');

            } catch (error) {
                alert('오류: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function matchPrograms() {
            const apiKey = document.getElementById('apiKey').value;
            const region = document.getElementById('regionSelect').value;

            if (!n2bAnalysis) {
                alert('먼저 N2B 분석을 수행해주세요.');
                return;
            }

            showLoading(true);

            try {
                const response = await fetch(`${API_BASE}/match`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        apiKey, 
                        n2bAnalysis,
                        region
                    })
                });

                if (!response.ok) throw new Error('매칭 실패');

                const result = await response.json();

                const regionBadge = document.getElementById('regionBadge');
                regionBadge.textContent = `📍 ${region === '전체' ? '전국' : region}`;

                const listDiv = document.getElementById('programList');
                
                if (result.programs && result.programs.length > 0) {
                    listDiv.innerHTML = result.programs.map((p, i) => `
                        <div class="bg-white rounded-xl shadow-md p-6 card-hover transition">
                            <div class="flex justify-between items-start">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs">${p.region || region}</span>
                                        <span class="px-2 py-1 bg-green-100 text-green-700 rounded text-xs">매칭 ${p.matchScore || 85}%</span>
                                    </div>
                                    <h3 class="text-lg font-bold text-gray-800">${p.name}</h3>
                                    <p class="text-gray-600 text-sm mt-1">🏢 ${p.organization}</p>
                                    <p class="text-gray-600 text-sm">📅 마감: ${p.deadline}</p>
                                    <p class="text-gray-600 text-sm">💰 ${p.amount}</p>
                                    <p class="text-purple-600 text-sm mt-2">💡 ${p.matchReason}</p>
                                </div>
                                <a href="${p.url}" target="_blank" 
                                   class="ml-4 px-4 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 transition text-sm whitespace-nowrap">
                                    상세보기 →
                                </a>
                            </div>
                        </div>
                    `).join('');
                } else {
                    listDiv.innerHTML = `
                        <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-6 text-center">
                            <p class="text-yellow-700">😅 현재 ${region === '전체' ? '전국에서' : region + '에서'} 모집중인 매칭 사업이 없습니다.</p>
                            <p class="text-gray-600 text-sm mt-2">다른 지역을 선택하거나 나중에 다시 시도해주세요.</p>
                        </div>
                    `;
                }

                document.getElementById('matchResult').classList.remove('hidden');

            } catch (error) {
                alert('오류: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('hidden', !show);
        }
    </script>
</body>
</html>
