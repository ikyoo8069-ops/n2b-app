<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¬ê¸°ë¡œìš´ ê¸°ì—…ê²½ì˜ - ì œì•ˆì„œ ìë™ ìƒì„± ë°ëª¨</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Malgun Gothic', -apple-system, sans-serif;
            background: linear-gradient(135deg, #0d1b2a 0%, #1b3a57 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        header {
            text-align: center;
            padding: 30px 0;
            color: white;
        }
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        header h1 span { color: #ff6b35; }
        header p { color: #94a3b8; font-size: 1.1em; }
        
        .section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .section h3 {
            color: #0d1b2a;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #ff6b35;
        }
        
        textarea {
            width: 100%;
            height: 150px;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            resize: vertical;
        }
        textarea:focus {
            outline: none;
            border-color: #ff6b35;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        }
        .btn-primary {
            background: linear-gradient(135deg, #ff6b35 0%, #e55a2b 100%);
            color: white;
        }
        .btn-secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .n2b-result {
            background: #f8fafc;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .n2b-item {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            align-items: flex-start;
        }
        .n2b-badge {
            width: 40px;
            height: 40px;
            background: #ff6b35;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }
        .n2b-content {
            flex: 1;
        }
        .n2b-content strong {
            color: #ff6b35;
            display: block;
            margin-bottom: 5px;
        }
        
        .policy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .policy-card {
            background: linear-gradient(135deg, #1b3a57 0%, #0d1b2a 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .policy-card:hover {
            transform: translateY(-3px);
            border-color: #ff6b35;
        }
        .policy-card.selected {
            border-color: #ff6b35;
            box-shadow: 0 0 20px rgba(255, 107, 53, 0.3);
        }
        .policy-card h4 { color: #ff6b35; margin-bottom: 10px; }
        .policy-card p { color: #94a3b8; font-size: 13px; line-height: 1.5; }
        
        .doc-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        
        #generatedContent {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
            max-height: 600px;
            overflow-y: auto;
        }
        #generatedContent h3 { color: #1b3a57; border-bottom: 2px solid #ff6b35; padding-bottom: 8px; margin: 20px 0 15px 0; }
        #generatedContent h4 { color: #374151; margin: 15px 0 10px 0; }
        #generatedContent p, #generatedContent li { line-height: 1.8; color: #4b5563; }
        
        .loading {
            text-align: center;
            padding: 40px;
        }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top-color: #ff6b35;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        .demo-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: inline-block;
            margin-bottom: 15px;
        }
        
        .remaining-info {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 10px 15px;
            margin-bottom: 20px;
            font-size: 14px;
            color: #92400e;
        }
        
        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #e2e8f0;
            color: #64748b;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .step.active {
            background: #ff6b35;
            color: white;
        }
        .step.completed {
            background: #10b981;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ìŠ¬ê¸°ë¡œìš´ <span>ê¸°ì—…ê²½ì˜</span></h1>
            <p>N2B ê¸°ë°˜ AI ê²½ì˜ íŒŒíŠ¸ë„ˆ - ì œì•ˆì„œ ìë™ ìƒì„± ë°ëª¨</p>
            <div class="demo-badge">ğŸ¯ ë°ëª¨ ëª¨ë“œ - API í‚¤ ë¶ˆí•„ìš”</div>
        </header>
        
        <div class="step-indicator">
            <div class="step active" id="step1">1</div>
            <div class="step" id="step2">2</div>
            <div class="step" id="step3">3</div>
            <div class="step" id="step4">4</div>
        </div>
        
        <!-- ë‚¨ì€ ìš”ì²­ íšŸìˆ˜ í‘œì‹œ -->
        <div class="remaining-info" id="remainingInfo">
            â³ ë‚¨ì€ ë°ëª¨ ìš”ì²­: <strong id="remainingCount">í™•ì¸ ì¤‘...</strong>íšŒ (ì¼ì¼ í•œë„)
        </div>
        
        <!-- Step 1: ê¸°ì—… ì •ë³´ ì…ë ¥ -->
        <div class="section" id="inputSection">
            <h3>ğŸ“ Step 1: ê¸°ì—… ì •ë³´ ì…ë ¥</h3>
            <div style="margin-bottom: 15px;">
                <strong>ìƒ˜í”Œ ì„ íƒ:</strong>
                <button class="btn" style="background: #6b7280; color: white; padding: 8px 15px; margin: 5px;" onclick="loadSample(1)">ìƒ˜í”Œ1: ì œì¡°ì—…</button>
                <button class="btn" style="background: #6b7280; color: white; padding: 8px 15px; margin: 5px;" onclick="loadSample(2)">ìƒ˜í”Œ2: ITìŠ¤íƒ€íŠ¸ì—…</button>
                <button class="btn" style="background: #6b7280; color: white; padding: 8px 15px; margin: 5px;" onclick="loadSample(3)">ìƒ˜í”Œ3: ì†Œìƒê³µì¸</button>
            </div>
            <textarea id="companyInfo" placeholder="ê¸°ì—…ì˜ í˜„ì¬ ìƒí™©ê³¼ ê³ ë¯¼ì„ ììœ ë¡­ê²Œ ì‘ì„±í•´ì£¼ì„¸ìš”."></textarea>
            <button class="btn btn-primary" onclick="runN2bAnalysis()" style="margin-top: 15px;">
                ğŸ” N2B ë¶„ì„ ì‹œì‘
            </button>
        </div>
        
        <!-- Step 2: N2B ë¶„ì„ ê²°ê³¼ -->
        <div class="section" id="n2bSection" style="display: none;">
            <h3>ğŸ§  Step 2: N2B ë¶„ì„ ê²°ê³¼</h3>
            <div id="n2bLoading" class="loading">
                <div class="spinner"></div>
                <p>AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
            </div>
            <div id="n2bResult" class="n2b-result" style="display: none;"></div>
            <button class="btn btn-primary" onclick="showPolicies()" id="nextToPolicy" style="display: none; margin-top: 15px;">
                ë‹¤ìŒ: ì§€ì›ì‚¬ì—… ì¶”ì²œ ë³´ê¸° â†’
            </button>
        </div>
        
        <!-- Step 3: ì •ì±… ì„ íƒ -->
        <div class="section" id="policySection" style="display: none;">
            <h3>ğŸ¯ Step 3: ì§€ì›ì‚¬ì—… ì„ íƒ</h3>
            <p style="color: #666; margin-bottom: 15px;">ì•„ë˜ ì¶”ì²œ ì‚¬ì—… ì¤‘ í•˜ë‚˜ë¥¼ ì„ íƒí•˜ì„¸ìš”.</p>
            <div class="policy-grid" id="policyGrid"></div>
        </div>
        
        <!-- Step 4: ë¬¸ì„œ ìƒì„± -->
        <div class="section" id="docSection" style="display: none;">
            <h3>ğŸ“„ Step 4: ë¬¸ì„œ ìë™ ìƒì„±</h3>
            <div style="background: #e8f4fd; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                <strong>ì„ íƒí•œ ì‚¬ì—…:</strong> <span id="selectedProgramName">-</span>
            </div>
            
            <div class="doc-buttons">
                <button class="btn btn-secondary" onclick="generateProposal()">
                    ğŸ“„ ì œì•ˆì„œ ì´ˆì•ˆ ìƒì„±
                </button>
                <button class="btn btn-success" onclick="generatePptOutline()">
                    ğŸ“Š ë°œí‘œìë£Œ êµ¬ì„±ì•ˆ ìƒì„±
                </button>
            </div>
            
            <div id="docLoading" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>AIê°€ ë¬¸ì„œë¥¼ ì‘ì„± ì¤‘ì…ë‹ˆë‹¤... (ì•½ 30ì´ˆ)</p>
            </div>
            
            <div id="generatedContent" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h4 id="contentTitle">ìƒì„±ëœ ë¬¸ì„œ</h4>
                    <button class="btn" style="background: #6b7280; color: white; padding: 8px 16px;" onclick="copyContent()">
                        ğŸ“‹ ë³µì‚¬
                    </button>
                </div>
                <div id="contentArea"></div>
            </div>
        </div>
    </div>
    
    <script>
        // ============================================
        // ì„¤ì •
        // ============================================
        const BACKEND_URL = 'https://n2b-backend.onrender.com';
        
        let currentN2bResult = null;
        let selectedProgram = null;
        let companyInfo = '';
        
        // ============================================
        // ì´ˆê¸°í™” - ë‚¨ì€ ìš”ì²­ íšŸìˆ˜ í™•ì¸
        // ============================================
        async function checkDemoStatus() {
            try {
                const response = await fetch(`${BACKEND_URL}/demo/status`);
                const data = await response.json();
                document.getElementById('remainingCount').textContent = data.remaining_requests;
                
                if (!data.available) {
                    document.getElementById('remainingInfo').innerHTML = 
                        'âš ï¸ ë°ëª¨ ëª¨ë“œê°€ í˜„ì¬ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤.';
                    document.getElementById('remainingInfo').style.background = '#fee2e2';
                    document.getElementById('remainingInfo').style.borderColor = '#ef4444';
                }
            } catch (error) {
                document.getElementById('remainingCount').textContent = 'í™•ì¸ ë¶ˆê°€';
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ í™•ì¸
        checkDemoStatus();
        
        // ============================================
        // ìƒ˜í”Œ ë°ì´í„°
        // ============================================
        const samples = {
            1: `[ì œì¡°ì—… - ìë™ì°¨ ë¶€í’ˆ]
- ì—…ì¢…: ì œì¡°ì—… (ìë™ì°¨ ë¶€í’ˆ)
- ê·œëª¨: 5ë…„ì°¨, ì§ì› 15ëª…, ì—°ë§¤ì¶œ 20ì–µ
- ì§€ì—­: ê²½ê¸°ë„ í™”ì„±ì‹œ
- í˜„ì¬ ê³ ë¯¼: ì¸ë ¥ ì±„ìš©ì´ ì–´ë µê³  ë§¤ì¶œì´ ì •ì²´ë˜ì–´ ìˆìŒ. ëŒ€ê¸°ì—… ë‚©í’ˆ ë‹¨ê°€ ì¸í•˜ ì••ë°•.
- ë³´ìœ  ì—­ëŸ‰: ISO ì¸ì¦, í’ˆì§ˆì¸ì¦ ë³´ìœ , ìì²´ ê¸ˆí˜• ê¸°ìˆ 
- ëª©í‘œ: ìŠ¤ë§ˆíŠ¸ê³µì¥ ë„ì…ìœ¼ë¡œ ìƒì‚°ì„± í–¥ìƒ, ì‹ ê·œ ê±°ë˜ì²˜ í™•ë³´`,

            2: `[IT ìŠ¤íƒ€íŠ¸ì—… - AI ì†”ë£¨ì…˜]
- ì—…ì¢…: IT/ì†Œí”„íŠ¸ì›¨ì–´ (AI ê¸°ë°˜ ê³ ê°ë¶„ì„ ì†”ë£¨ì…˜)
- ê·œëª¨: ì°½ì—… 2ë…„ì°¨, ì§ì› 8ëª…, ì—°ë§¤ì¶œ 5ì–µ
- ì§€ì—­: ì„œìš¸ ê°•ë‚¨êµ¬
- í˜„ì¬ ê³ ë¯¼: ê¸°ìˆ ê°œë°œ ì¸ë ¥ ë¶€ì¡±, ë§ˆì¼€íŒ… ë¹„ìš© ë¶€ë‹´, ì‹œë¦¬ì¦ˆA íˆ¬ì ìœ ì¹˜ í•„ìš”
- ë³´ìœ  ì—­ëŸ‰: AI/ML í•µì‹¬ ê¸°ìˆ , íŠ¹í—ˆ 2ê±´, ëŒ€ê¸°ì—… PoC ê²½í—˜
- ëª©í‘œ: í•´ì™¸ ì§„ì¶œ, íˆ¬ì ìœ ì¹˜, R&D ì—­ëŸ‰ ê°•í™”`,

            3: `[ì†Œìƒê³µì¸ - ì¹´í˜/ë² ì´ì»¤ë¦¬]
- ì—…ì¢…: ìŒì‹ì ì—… (ì¹´í˜ ê²¸ ë² ì´ì»¤ë¦¬)
- ê·œëª¨: ì°½ì—… 3ë…„ì°¨, ì§ì› 3ëª…, ì—°ë§¤ì¶œ 2ì–µ
- ì§€ì—­: ë¶€ì‚° í•´ìš´ëŒ€êµ¬
- í˜„ì¬ ê³ ë¯¼: í”„ëœì°¨ì´ì¦ˆ ê²½ìŸ ì‹¬í™”, ì›ìì¬ ê°€ê²© ìƒìŠ¹, ì˜¨ë¼ì¸ íŒë§¤ í™•ëŒ€ í•„ìš”
- ë³´ìœ  ì—­ëŸ‰: ìˆ˜ì œ ë² ì´ì»¤ë¦¬ ë ˆì‹œí”¼, ë‹¨ê³¨ ê³ ê°ì¸µ, SNS ë§ˆì¼€íŒ… ê²½í—˜
- ëª©í‘œ: ì˜¨ë¼ì¸ íŒë§¤ ì‹œì‘, ë°°ë‹¬ ì„œë¹„ìŠ¤ í™•ëŒ€, 2í˜¸ì  ì˜¤í”ˆ`
        };
        
        function loadSample(num) {
            document.getElementById('companyInfo').value = samples[num];
        }
        
        // ============================================
        // ìƒ˜í”Œ ì •ì±… ë°ì´í„°
        // ============================================
        const samplePolicies = [
            {
                name: "ìŠ¤ë§ˆíŠ¸ê³µì¥ êµ¬ì¶• ì§€ì›ì‚¬ì—…",
                description: "ì¤‘ì†Œê¸°ì—…ì˜ ìŠ¤ë§ˆíŠ¸ê³µì¥ êµ¬ì¶•ì„ ìœ„í•œ ì‹œìŠ¤í…œ ë„ì… ë¹„ìš© ì§€ì›. ìµœëŒ€ 3ì–µì›, ìë¶€ë‹´ 30%",
                budget: "ìµœëŒ€ 3ì–µì›"
            },
            {
                name: "ì¤‘ì†Œê¸°ì—… R&D ì—­ëŸ‰ê°•í™” ì‚¬ì—…",
                description: "ê¸°ìˆ ê°œë°œ ì—­ëŸ‰ ê°•í™”ë¥¼ ìœ„í•œ ì—°êµ¬ì¸ë ¥ ì¸ê±´ë¹„ ë° ì—°êµ¬ë¹„ ì§€ì›",
                budget: "ìµœëŒ€ 2ì–µì›"
            },
            {
                name: "ê³ ìš©ì´‰ì§„ì¥ë ¤ê¸ˆ",
                description: "ì²­ë…„, ì¥ë…„ ì‹ ê·œ ì±„ìš© ì‹œ ì¸ê±´ë¹„ ì¼ë¶€ ì§€ì›. 1ì¸ë‹¹ ì—° 960ë§Œì›",
                budget: "1ì¸ë‹¹ 960ë§Œì›"
            },
            {
                name: "ìˆ˜ì¶œë°”ìš°ì²˜ ì‚¬ì—…",
                description: "í•´ì™¸ ë§ˆì¼€íŒ…, ì¸ì¦, í†µë²ˆì—­ ë“± ìˆ˜ì¶œ ê´€ë ¨ ì„œë¹„ìŠ¤ ì´ìš©ê¶Œ ì§€ì›",
                budget: "ìµœëŒ€ 1ì–µì›"
            }
        ];
        
        // ============================================
        // ë‹¨ê³„ ì—…ë°ì´íŠ¸
        // ============================================
        function updateSteps(activeStep) {
            for (let i = 1; i <= 4; i++) {
                const step = document.getElementById(`step${i}`);
                step.classList.remove('active', 'completed');
                if (i < activeStep) step.classList.add('completed');
                if (i === activeStep) step.classList.add('active');
            }
        }
        
        // ============================================
        // N2B ë¶„ì„ (ë°ëª¨ ë°±ì—”ë“œ ì‚¬ìš©)
        // ============================================
        async function runN2bAnalysis() {
            companyInfo = document.getElementById('companyInfo').value;
            if (!companyInfo.trim()) {
                alert('ê¸°ì—… ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            document.getElementById('n2bSection').style.display = 'block';
            document.getElementById('n2bLoading').style.display = 'block';
            document.getElementById('n2bResult').style.display = 'none';
            updateSteps(2);
            
            try {
                const response = await fetch(`${BACKEND_URL}/demo/analyze`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        proposalText: companyInfo
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ë¶„ì„ ì‹¤íŒ¨');
                }
                
                const data = await response.json();
                
                // ë‚¨ì€ ìš”ì²­ íšŸìˆ˜ ì—…ë°ì´íŠ¸
                if (data.remaining_requests !== undefined) {
                    document.getElementById('remainingCount').textContent = data.remaining_requests;
                }
                
                // JSON íŒŒì‹±
                const text = data.result;
                const jsonMatch = text.match(/\{[\s\S]*\}/);
                if (jsonMatch) {
                    const parsed = JSON.parse(jsonMatch[0]);
                    currentN2bResult = {
                        not: parsed.not || parsed.n || '',
                        but: parsed.but || parsed.b || '',
                        because: parsed.because || parsed.c || ''
                    };
                    displayN2bResult(currentN2bResult);
                }
                
            } catch (error) {
                alert('ë¶„ì„ ì˜¤ë¥˜: ' + error.message);
            } finally {
                document.getElementById('n2bLoading').style.display = 'none';
            }
        }
        
        function displayN2bResult(result) {
            document.getElementById('n2bResult').innerHTML = `
                <div class="n2b-item">
                    <div class="n2b-badge">N</div>
                    <div class="n2b-content">
                        <strong>NOT (ë¬¸ì œì )</strong>
                        <p>${result.not || 'ë¶„ì„ ê²°ê³¼ ì—†ìŒ'}</p>
                    </div>
                </div>
                <div class="n2b-item">
                    <div class="n2b-badge">B</div>
                    <div class="n2b-content">
                        <strong>BUT (í•´ê²°ì±…)</strong>
                        <p>${result.but || 'ë¶„ì„ ê²°ê³¼ ì—†ìŒ'}</p>
                    </div>
                </div>
                <div class="n2b-item">
                    <div class="n2b-badge">B</div>
                    <div class="n2b-content">
                        <strong>BECAUSE (ê·¼ê±°)</strong>
                        <p>${result.because || 'ë¶„ì„ ê²°ê³¼ ì—†ìŒ'}</p>
                    </div>
                </div>
            `;
            document.getElementById('n2bResult').style.display = 'block';
            document.getElementById('nextToPolicy').style.display = 'inline-block';
        }
        
        // ============================================
        // ì •ì±… í‘œì‹œ ë° ì„ íƒ
        // ============================================
        function showPolicies() {
            document.getElementById('policySection').style.display = 'block';
            updateSteps(3);
            
            const grid = document.getElementById('policyGrid');
            grid.innerHTML = samplePolicies.map((policy, idx) => `
                <div class="policy-card" onclick="selectPolicy(${idx})" id="policy-${idx}">
                    <h4>${policy.name}</h4>
                    <p>${policy.description}</p>
                    <p style="color: #ff6b35; margin-top: 10px; font-weight: bold;">ğŸ’° ${policy.budget}</p>
                </div>
            `).join('');
            
            document.getElementById('policySection').scrollIntoView({ behavior: 'smooth' });
        }
        
        function selectPolicy(idx) {
            document.querySelectorAll('.policy-card').forEach(card => card.classList.remove('selected'));
            document.getElementById(`policy-${idx}`).classList.add('selected');
            selectedProgram = samplePolicies[idx];
            
            document.getElementById('selectedProgramName').textContent = selectedProgram.name;
            document.getElementById('docSection').style.display = 'block';
            document.getElementById('generatedContent').style.display = 'none';
            updateSteps(4);
            
            document.getElementById('docSection').scrollIntoView({ behavior: 'smooth' });
        }
        
        // ============================================
        // ì œì•ˆì„œ ìƒì„± (ë°ëª¨ ë°±ì—”ë“œ ì‚¬ìš©)
        // ============================================
        async function generateProposal() {
            if (!selectedProgram) return;
            
            document.getElementById('docLoading').style.display = 'block';
            document.getElementById('generatedContent').style.display = 'none';
            
            try {
                const response = await fetch(`${BACKEND_URL}/demo/proposal`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        companyInfo: companyInfo,
                        n2bResult: currentN2bResult,
                        selectedProgram: selectedProgram
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ìƒì„± ì‹¤íŒ¨');
                }
                
                const data = await response.json();
                
                // ë‚¨ì€ ìš”ì²­ íšŸìˆ˜ ì—…ë°ì´íŠ¸
                if (data.remaining_requests !== undefined) {
                    document.getElementById('remainingCount').textContent = data.remaining_requests;
                }
                
                document.getElementById('contentTitle').textContent = 'ğŸ“„ ì œì•ˆì„œ ì´ˆì•ˆ';
                document.getElementById('contentArea').innerHTML = formatContent(data.result);
                document.getElementById('generatedContent').style.display = 'block';
                
            } catch (error) {
                alert('ìƒì„± ì˜¤ë¥˜: ' + error.message);
            } finally {
                document.getElementById('docLoading').style.display = 'none';
            }
        }
        
        // ============================================
        // PPT êµ¬ì„±ì•ˆ ìƒì„± (ë°ëª¨ ë°±ì—”ë“œ ì‚¬ìš©)
        // ============================================
        async function generatePptOutline() {
            if (!selectedProgram) return;
            
            document.getElementById('docLoading').style.display = 'block';
            document.getElementById('generatedContent').style.display = 'none';
            
            try {
                const response = await fetch(`${BACKEND_URL}/demo/ppt`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        companyInfo: companyInfo,
                        n2bResult: currentN2bResult,
                        selectedProgram: selectedProgram
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.detail || 'ìƒì„± ì‹¤íŒ¨');
                }
                
                const data = await response.json();
                
                // ë‚¨ì€ ìš”ì²­ íšŸìˆ˜ ì—…ë°ì´íŠ¸
                if (data.remaining_requests !== undefined) {
                    document.getElementById('remainingCount').textContent = data.remaining_requests;
                }
                
                document.getElementById('contentTitle').textContent = 'ğŸ“Š ë°œí‘œìë£Œ êµ¬ì„±ì•ˆ';
                document.getElementById('contentArea').innerHTML = formatContent(data.result);
                document.getElementById('generatedContent').style.display = 'block';
                
            } catch (error) {
                alert('ìƒì„± ì˜¤ë¥˜: ' + error.message);
            } finally {
                document.getElementById('docLoading').style.display = 'none';
            }
        }
        
        // ============================================
        // ë§ˆí¬ë‹¤ìš´ í¬ë§· ë³€í™˜
        // ============================================
        function formatContent(text) {
            let result = text;
            
            // ë§ˆí¬ë‹¤ìš´ í‘œ â†’ HTML í‘œ ë³€í™˜
            const tableRegex = /(\|.+\|\n)+/g;
            result = result.replace(tableRegex, function(table) {
                const rows = table.trim().split('\n');
                let html = '<table style="width:100%; border-collapse:collapse; margin:15px 0;">';
                
                rows.forEach((row, idx) => {
                    if (row.match(/^\|[\s\-:]+\|$/)) return;
                    
                    const cells = row.split('|').filter(c => c.trim() !== '');
                    const tag = idx === 0 ? 'th' : 'td';
                    const bgColor = idx === 0 ? 'background:#f3f4f6;' : '';
                    
                    html += '<tr>';
                    cells.forEach(cell => {
                        html += `<${tag} style="border:1px solid #e5e7eb; padding:10px; ${bgColor}">${cell.trim()}</${tag}>`;
                    });
                    html += '</tr>';
                });
                
                html += '</table>';
                return html;
            });
            
            // ë‚˜ë¨¸ì§€ ë§ˆí¬ë‹¤ìš´ ë³€í™˜
            return result
                .replace(/### (.*)/g, '<h3>$1</h3>')
                .replace(/#### (.*)/g, '<h4>$1</h4>')
                .replace(/## (.*)/g, '<h2 style="color:#1b3a57; border-bottom:2px solid #ff6b35; padding-bottom:5px; margin-top:20px;">$1</h2>')
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                .replace(/- (.*)/g, '<li>$1</li>')
                .replace(/\n/g, '<br>');
        }
        
        // ============================================
        // ë³µì‚¬ ê¸°ëŠ¥
        // ============================================
        function copyContent() {
            const content = document.getElementById('contentArea').innerText;
            navigator.clipboard.writeText(content).then(() => {
                alert('í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            });
        }
    </script>
</body>
</html>
